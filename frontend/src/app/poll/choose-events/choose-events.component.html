<div class="d-flex justify-content-center">
  <div class="col-6 justify-content-center">
    <div *ngIf="pollEvents" class="table-responsive text-center">
      <form class="m-5" [formGroup]="participateForm" (ngSubmit)="onFormSubmit()">
        <table class="table">
          <thead>
          <tr>
            <th scope="col"></th>
            <th *ngFor="let event of pollEvents" scope="col">
              <div class="vote-option">
                {{ event.start | date:'E' }} <br>
                <h3><b>{{ event.start | date:'d' }}</b></h3>
                <div class="month-text">{{ event.start | date:'MMM' }}</div>
                {{ event.start | date:'HH:mm' }}- {{ event.end | date:'HH:mm' }}
              </div>
            </th>
            <th class="border-0" scope="col"></th>
          </tr>
          </thead>
          <tbody>
          <tr *ngIf="!isFull()">
            <th style="min-width: 240px" scope="row">
              <input *ngIf="!poll?.settings?.allowAnonymous"
                     class="form-control"
                     type="text"
                     id="name"
                     placeholder="Your name"
                     formControlName="name">
            </th>
            <td *ngFor="let check of checks; let n=index">
              <div class="d-flex justify-content-center">
                <button
                  class="form-check-input rounded-circle"
                  type="button"
                  [class.button-checked]="check === 'true' || check === 'indeterminate'"
                  (click)="checkBox(checks, n)">
                  <i *ngIf="check === 'true'" class="bi-check button-icon"></i>
                  <i *ngIf="check === 'indeterminate'" class="bi-dash button-icon"></i>
                </button>
              </div>
            </td>
            <th class="border-0 text-start" scope="col">
              <button class="btn btn-primary btn-sm" type="submit" [disabled]="!participateForm.valid">Submit</button>
            </th>
          </tr>
          <ng-container *ngIf="!poll?.settings?.blindParticipation || isAdmin() || userVoted()">
            <tr *ngFor="let participant of participants">
              <th>
                <div *ngIf="!poll?.settings?.allowAnonymous">
                  {{participant.name}}
                </div>
              </th>
              <ng-container *ngIf="participant !== editParticipant">
                <td *ngFor="let pollEvent of pollEvents; let n=index">
                  <div *ngIf="(participant.participation | some: pollEvent._id ) && participant !== editParticipant"
                       class="p-check">
                    <i class="bi-check-lg icon"></i>
                  </div>
                  <div *ngIf="!(participant.participation | some: pollEvent._id )
                && !(participant.indeterminateParticipation | some: pollEvent._id ) && participant !== editParticipant"
                       class="p-unchecked">
                    <i class="bi-x-lg icon"></i>
                  </div>
                  <div
                    *ngIf="(participant.indeterminateParticipation | some: pollEvent._id ) && participant !== editParticipant"
                    class="p-indeterminate">
                    <i class="bi-question icon"></i>
                  </div>
                </td>
              </ng-container>
              <ng-container *ngIf="participant === editParticipant">
                <td *ngFor="let check of editChecks; let n=index">
                  <div class="d-flex justify-content-center">
                    <button
                      class="form-check-input rounded-circle"
                      type="button"
                      [class.button-checked]="check === 'true' || check === 'indeterminate'"
                      (click)="checkBox(editChecks, n)">
                      <i *ngIf="check === 'true'" class="bi-check button-icon"></i>
                      <i *ngIf="check === 'indeterminate'" class="bi-dash button-icon"></i>
                    </button>
                  </div>
                </td>
              </ng-container>
              <td *ngIf="participant === editParticipant" class="border-0 text-start">
                <button class="btn btn-primary btn-sm ms-1" type="button" (click)="cancelEdit()">
                  <i class="bi-x"></i>
                </button>
                <button class="btn btn-secondary btn-sm ms-1" type="button" (click)="confirmEdit()">
                  <i class="bi-check"></i>
                </button>
              </td>
              <td *ngIf="!editParticipant" class="border-0 text-start">
                <button
                  *ngIf="getToken() === participant.token"
                  class="btn btn-primary btn-sm ms-1"
                  placement="top"
                  ngbTooltip="Edit participation"
                  (click)="editParticipant = participant"
                >
                  <i class="bi-pencil"></i>
                </button>
                <button
                  *ngIf="isAdmin() || getToken() === participant.token"
                  class="btn btn-sm btn-danger ms-1"
                  type="button"
                  placement="top"
                  ngbTooltip="Delete participation"
                  (click)="deleteParticipation(participant._id)"
                >
                  <i class="bi-trash"></i>
                </button>
              </td>
            </tr>
          </ng-container>
          <tr *ngIf="!poll?.settings?.blindParticipation || isAdmin() || userVoted()">
            <th>
              Sum
            </th>
            <td *ngFor="let pollEvent of pollEvents">
              <div *ngIf="bestOption === countParticipants(pollEvent)" class="p-unchecked">
                <i class="bi-award"></i>
                {{ countParticipants(pollEvent) }}
              </div>
              <div *ngIf="bestOption !== countParticipants(pollEvent)">
                {{ countParticipants(pollEvent) }}
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </form>
    </div>
  </div>
</div>
